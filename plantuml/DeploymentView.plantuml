@startuml
skinparam componentStyle rectangle
node "Kubernetes Cluster" {
 node "Namespace: prod" {
 node "API Gateway Pod" {
 [Gateway] - [OPA Sidecar]
 }
 node "Service A Pod" {
 [Service A] - [OPA Sidecar]
 }
 node "Service B Pod" {
 [Service B] - [OPA Sidecar]
 }
 node "Policy Bundle Server" as PBS
 node "Observability" {
 [Logs/ELK]
 [Metrics/Prom]
 [Tracing/Jaeger]
 }
 }
}
PBS --> [OPA Sidecar] : HTTPS bundle downloads
[Service A] --> [OPA Sidecar] : mTLS /v1/data/app/allow
[Gateway] --> [OPA Sidecar] : mTLS /v1/data/app/allow
[OPA Sidecar] --> [Logs/ELK] : decision logs
@enduml